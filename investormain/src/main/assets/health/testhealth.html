<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  user-scalable=yes">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link href="commons.css" rel="stylesheet">
    <link href="healthConsultation.css" rel="stylesheet">
    <title></title>
</head>
<body>
<!--专题内容-->
<div class="detailWrap" id="page"></div>
<script type="text/javascript" src="our.js"></script>
<script>

    var _Request = Request;
    Request = function(url, options) {
        this.options = options || {};
        this.url = url;

        var protocol = location.protocol;
        if (protocol === 'file:') { //本地直接调用
            JSEventTarget.create(this);
        } else if (protocol === 'http:' || protocol === 'https:') { //通过URL调用
            var token = cookie.getItem('token');
            var uid = cookie.getItem('uid');
            var client = cookie.getItem('client');
            var mid = cookie.getItem('mid');
            var version = cookie.getItem('version');

            var defaultOptions = {};
            defaultOptions.headers = {
                'Accept': '*/*',
                'token': token,
                'adviserId': uid,
                'mid': mid,
                'version': version
            };

            Object.mixin(options, defaultOptions);

            if (!!client) {
                options.headers['client'] = client;
            }

            options.contentType = options.contentType || 'application/json';
            options.maxTime = 15000;

            var _request = new _Request(url, options);
            _request.on('timeout', function() {
                if (token) {
//                    sendCommand('toastError', '当前网络信号较弱，页面打开较慢，请您耐心等待或返回重试');
                }
            });
            return _request;
        } else {
        }
    };

    Request.prototype.send = function(data) {
        var userAgent = navigator.userAgent;
        var options = this.options;
        var url = this.url;
        var method = options.method;
        var dataPackage = JSON.stringify(data);

        var self = this;
        var tempFuncName = 'func' + Date.now();
        Request[tempFuncName] = function(status, dataString) {
            status = status - 0;
            var dataText;
            if (arguments.length === 2) {
                dataText = decodeURIComponent(dataString);
            } else {
                dataText = window.simuyun.getRequestValue('Request.' + tempFuncName);
            }
            if (status === 200) {
                self.fire('complete', {
                    status: status,
                    text: dataText
                });
            }

            self.fire('finish', {
                status: status,
                text: dataText
            });

            delete Request[tempFuncName];
        };

        if (/android/i.test(userAgent)) { //安卓
        sendCommand('toastError', 'start');
            window.simuyun.sendRemoteRequest(method, url, dataPackage, 'Request.' + tempFuncName);
            sendCommand('toastError', 'end');
        } else if (/iPad|iPhone|iPod/.test(userAgent)) { //iOS
            window.webkit.messageHandlers.commond.postMessage({
                'event': 'sendRemoteRequest',
                'method': method,
                'url': url,
                'param': dataPackage,
                'jsFunction': 'Request.' + tempFuncName
            });
        }
    };
    //    window.webkit.messageHandlers.commond.postMessage({'event':'sendRemoteRequest','method':'get','url':'/api/v2/health/news','param':'{"id":"2e4cdcbae0f14351a14b644c9ba83732"}','jsFunction':'renderTodayInfo'});

    var request = new Request('/api/v2/health/news', {
        'method': 'GET'
    });

    request.on('finish', function(event) {
        alert(event.status);
        alert(event.text);
    });

    request.send({
        "id": "2e4cdcbae0f14351a14b644c9ba83732"
    });

</script>
</body>
</html>
